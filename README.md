# FoxDec: Formaly Verified x86-64 Decompilation

FoxDec is a tool, currently actively being developped, that aims at formally verified decompilation. In its current stage, it does disassembly, control flow reconstruction and function boundary detection.

## Table of Contents
1. [How to build](#build)
2. [How to use](#usage)


## How to build <a name="build"></a>
1. Install [Graphviz](https://graphviz.org) and make sure `dot` is accessible by updating to the `PATH` environment variable.
1. Install [Stack](https://docs.haskellstack.org/en/stable/README/), the build tool used for developping FoxDec. 
2. From `./foxdec`, run `stack build --haddock --haddock-arguments --odir=docs/haddock`.
This builds the application and generates documentation using [Haddock](https://haskell-haddock.readthedocs.io/en/latest/index.html).
3. From `./foxdec`, run `stack exec foxdec-exe 1 ../examples/du du`. This runs FoxDec on the `du` example.

## How to use <a name="usage"></a>
1. Extract information from a binary.
2. Run FoxDec to generate a `.report` file.
3. Access/browse the verification results.

###1. Extracting information from a binary<a name="usage1"></a>
Before FoxDec can be applied to a binary, several files need to be generated. 
We provide scripts `dump_elf.sh` and `dump_macho.sh` that generate these files automatically for respectively files in the ELF (Linux) and MACH-O (MacOS) format.

    ./dump_elf.sh BINARY NAME
    
Here, `BINARY` is the name of the binary and `NAME` is a short working title (without file extensions or paths). For example:

	mkdir du
	cd du
    ./dump_elf.sh /usr/bin/du du

This generates a new directory `du` and generates the following files:

- **`NAME.dump`**: We use `readelf` to get an overview of all segments/sections in the binary. For each relevant section, a hex-dump is appended to **`NAME.dump`**.
- **`NAME.section`**: A plain-text file containing an overview of all relevant segments/sections.
- **`NAME.symbols`**: A plain-text file containing an overview of all external function symbols.
- **`NAME.entry`**: A plain-text file containing the entry points of the binary (one if executable, multiple if library).
- **`NAME.objdump`** (optional): For debugging purposes, we find it convenient to have the `objdump` available. This file is not used by FoxDec itself.

###2. Running FoxDec
    stack exec foxdec-exe PDF_YES_NO DIRNAME NAME
    
Here, `DIRNAME` is the name of the directory that contains the files generated by [step 1](#usage1). `NAME` is the same short working title as used during that step. Parameter `PDF_YES_NO` must be equal to either `1` or `0`, depending on whether FoxDec should use GraphViz to generate PDFs. For large example, we recommend `0` as `dot` will simply get stuck. Example usage:

    stack exec foxdec-exe 1 ../examples/du du

###3. Access .report file
See [here](./project/docs/haddock/index.html).


